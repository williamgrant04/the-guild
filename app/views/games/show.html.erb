<div class="main-container">
  <div class="upper-container">
    <div class="tabs">
      <%= link_to game_path(@game), class: "tab" do %>
        <p>Members</p>
      <% end %>
      <%= link_to chatroom_path(@game.chatroom), class: "tab" do %>
        <p>Chat</p>
      <% end %>
      <%= link_to @source.is_a?(Guild) ? guild_events_path(@guild) : game_events_path(@game), class: "tab" do %>
        <p>Events</p>
      <% end %>
    </div>

    <% if current_user.member.role == "admin" %>
    <div class="game-buttons">
      <div class="tabs">
        <%= link_to edit_game_path(@game), class: "tab" do %>
          <p>Edit</p>
        <% end %>
        <%= link_to game_path, data: { turbo_method: :delete, turbo_confirm: "Delete this game?" }, class: "delete tab" do %>
          <p>Delete</p>
        <% end %>
        <%= link_to new_game_game_member_path(@game), class: "tab add" do %>
          <p>Add member</p>
        <% end %>
      </div>
    </div>
    <% end %>
  </div>

  <div class="card-container">
    <div class="game-member-card-wrapper">
      <% @game.members.each do |member| %>
        <div class="game-member-card">
          <div class="action-wrapper">
            <% if current_user.member == member || current_user.member.role == "admin" %>
            <div class="edit">
                <%= link_to "Edit", edit_game_game_member_path(@game, member) %>
            </div>
            <div class="remove">
                <%= link_to "Remove", game_game_member_path(@game, member), data: { turbo_method: :delete, turbo_confirm: "Remove this member from the game?"} if current_user.member.role == "admin" %>
                <%= link_to "Leave", game_game_member_path(@game, member), data: { turbo_method: :delete, turbo_confirm: "Leave this game?"} if current_user.member == member && current_user.member.role != "admin" %>
            </div>
            <% end %>
          </div>

          <div class="card-image img" style="background-image: url(<%= cl_image_path(member.profile_image.key) %>">
          </div>

          <% member.game_members.each do |gm| %>
            <div class="card-details">
              <p><strong><i class="fa-solid fa-gamepad"></i>  <%= member.username %> - <%= gm.member_game_name %></strong></p>
              <p class="role-title"><i class="fa-solid fa-crown"></i> <%= member.role %></p>
              <p class="role-title"><i class="fa-solid fa-shield-halved"></i> <%= gm.details %></p>
          </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>
